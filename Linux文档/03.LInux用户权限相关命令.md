# Linux用户权限

## 01.用户 和 权限 的基本概念

</br>  
### 1.1 基本概念

* **用户** 是Linux系统的工作重要的一环，用户管理包括 **用户** 和 **组** 管理
* 在Linux系统中，不论是由本机或是远程登录系统，每个系统都**必须拥有一个账号**，并且**对于不同的系统资源拥有不同的使用权限**
* 在LInux中，可以指定 **每个用户** 针对 **不同的文件或者目录** 拥有 **不同权限**
* 对 **文件/目录**的权限包括：
    |权限|英文|缩写|数字代号
    |-|-|-|-
    |读|read|r|4
    |写|write|w|2
    |执行|excute|x|1

</br>  

### 1.2 组

* 为了方便用户管理，提出 **组**的概念，在实际过程中，可以预先针对 **组** 设置好权限，然后 **将不同用户添加到对应的组中**，从而**不用一次为每一个用户设置权限**

</br>  

### 1.3 **ls-l** 扩展

* <kbd>ls -l</kbd> 可以查看文件夹下的详细信息，从左到右一次是：
  
  * **权限**，第1个字符如果是 <kbd>d</kbd>表示目录
  * **硬链接数**，通俗地讲，就是有多少种方式，可以访问到当前目录/文件
  * **拥有者**，家目录下 文件/目录 的拥有者，通常都是当前用户
  * **组**，在Linux中，很多时候，会出现组名和用户名相同的情况
  * **大小**
  * **时间**
  * **名称**  

    ||目录|拥有者|组权限|其他用户权限
    |-|-|-|-|-
    |文件权限|-|r w - |r w -|r - -
    |目录权限|d|r w x |r w x|r - x

</br>  

### 1.4 **chmod** 简单使用（重要）

* <kbd>chmod</kbd> 可以修改 **用户/组** 对 **文件/目录** 的权限

        chmod +/-rwx 文件名/目录名
        + 表示增加权限
        - 表示减少权限

</br>  

### 1.5 超级用户

* 在Linux系统中， <kbd>root</kbd> 账号通常 **用于系统维护和管理**，对操作系统的所有资源 **具有所有访问权限**
* 在大多数版本的Linux中，都不推荐 **直接使用 root 账号登录系统**
* 在Linux安装的过程中，系统会自动创建一个用户账号，而这个默认用户就称为“标准用户”

* **sudo**
  
  * <kbd>su</kbd> 是 <kbd>substitute user</kbd> 的缩写，表示 **使用另一个用户身份**
  * <kbd>sudo</kbd> 命令用来以其他身份来执行命令，预设的身份为 <kbd>root</kbd>
  * 用户使用 <kbd>sudo</kbd> 时，必须先输入密码，之后有 **5分钟的有效期权限**，超过期限则必须重新输入密码

</br>  

## 02. 组管理 终端命令

> ***创建组/删除组*** 的终端命令都需要通过 <kbd>sudo</kbd> 执行

|命令|作用
|-|-
|groupadd 组名|添加组
|groupdel 组名|删除组
|cat /etc/group|确认组信息
|chgrp -R 组名 文件/目录名|修改文件/目录的所属组

**提示：**

* 组信息保存在 <kbd>/etc/group</kbd> 文件中
* <kbd>/etc</kbd> 目录是专门用来保存 **系统配置信息** 的目录

**演练目标**：  

1. 在 用户 桌面文件夹下创建 Python学习 目录  
2. 新建 dev 组  
3. 将 Python学习 目录的组修改为 dev  

        mkdir Python学习
        sudo groupadd dev
        sudo chgrp -R dev Python学习

</br>  

## 03. 用户管理的终端命令

> 提示：***创建用户/删除用户/修改其他用户密码*** 的终端命令都需要通过 <kbd>sudo</kbd> 执行

</br>  

### 3.1 创建用户/设置密码/删除用户

|命令|作用|说明
|-|-|-
|useradd -m -g 组 新建用户名|添加新用户| 1. -m 自动建立用户家目录 </br> 2. -g 指定用户所在的组，否则会建立一个同名的组
|passwd 用户名|设置用户密码|如果是普通用户，直接用 passwd 可以修改自己的账户密码
|userdel -r 用户名|删除用户|-r 选项会自动删除用户家目录
|cat/ect/passwd \| grep 用户名|确认用户信息|新建用户后，用户信息会自动保存在/ect/passwd文件夹中

**提示：**

* 创建用户是，如果忘记添加 <kbd>-m</kbd> 选项指定新用户的家目录，最简答的方法就是**删除用户，重新创建**
* 创建用户时，默认会创建一个和 **用户名** 同名的 **组名**
* 用户信息保存在 <kbd>/ect/passwd</kbd> 中

</br>  

### 3.2 查看用户信息

|命令|作用
|-|-
|id [用户名]|查看用户UID 和 GID 信息
|who|查看当前所登录的用户列表
|whoami|查看当前登录用户的账户名

**passwd** 文件
<kbd>/etc/passwd</kbd> 文件存放的是用户的信息，用6个分号组成的7个信息，分别是  

1. 用户名
2. 密码 （x，表示加密的密码）
3. UID （用户标识）
4. GID （组标识）
5. 用户全名或本地账号
6. 家目录
7. 登录使用的 Shell，就是登录之后的终端命令， <kbd>ubuntu</kbd> 就是默认是 <kbd>desh</kbd>

</br>  

**usermod**：

* <kbd>usermod</kbd> 可以用来设置 **用户** 的 **主组/附加组** 和 **登录Shell**
* **主组**：通常在新建用户时指定，在 <kbd>/ect/passwd</kbd> 的第4列 **GID对应组**
* **附加组**：在 <kbd>/ect/passwd</kbd> 中最后一列表示该组的用户列表，用于指定 **用户的附加权限**

> **提示：** 设置了用户的附加组之后，需要重新登录才能生效！

    修改用户的主组（passw 中的 GID）
    usermod -g 组 用户名

    修改用户的附加组
    usermod -G 组 用户名

    修改用户登录Shell
    usermod -s /bin/bash

> **注意：** 默认使用 <kbd>useradd</kbd> 添加用户是没有权限使用 <kbd>sudo</kbd> 以 <kbd>root</kbd> 身份执行命令的，可以使用一下命令，将用户添加到 <kbd>sudo</kbd> 附加组中

    usermod -G sudo 用户名

</br>  

**which**（重要）

> **提示：**
>
> * <kbd>/etc/passwd</kbd> 是用于保存用户信息的文件
> * <kbd>/user/bin/passwd</kbd> 是用于修改用户密码的程序

* <kbd>which</kbd> 命令可以查看执行命令所在位置

        which ls
        输出 /bin/ls

        which useradd
        输出 /user/sbin/useradd

</br>  

**bin 和 sbin**

* 在 Linux 中，绝大多数可执行文件都保存在 <kbd>/bin</kbd>、<kbd>/sbin</kbd>、<kbd>/user/bin</kbd>、<kbd>/user/sbin</kbd>
* <kbd>/bin</kbd> 是二进制执行文件，主要用于具体应用
* <kbd>sbin</kbd> 是系统管理员专用的二进制代码存放目录，主要用于系统管理
* <kbd>/user/bin</kbd> 后期安装的一些软件
* <kbd>/user/sbin</kbd> 超级用户的一些管理程序

> **提示：** <kbd>cd</kbd> 这个终端命令内置在系统内核中，没有独立的文件，因此用 <kbd>/which</kbd> 无法找到

</br>  

### 3.3 切换用户

|命令|作用|说明
|-|-|-
|su - 用户名|切换用户，并且切换目录| - 可以切换到用户家目录，否则位置保持不变
|exit|退出当前账户

* <kbd>su</kbd> 不接用户名，可以切换到 <kbd>root</kbd>，但是不推荐使用，因为不安全

## 04. 修改文件权限

|命令|作用
|-|-
|chown|修改拥有者
|chgrp|修改组
|chmod|修改权限

    修改文件|目录的拥有者
    chown 用户名 文件|目录

    递归修改文件|目录名
    chgrp -R 组名 文件名|目录名

    递归修改文件权限
    chmod -R 755 文件名|目录名

* <kbd>chmod</kbd> 在设置权限时，可以简单使用三个数字分别对应 **拥有者/组** 和 **其他** 用户权限

        直接修改文件|目录的 读|写|执行 权限，但不能精确到 拥有者|组|其他
        chmod +/-rwx 文件名|目录名

|拥有者|组|其他
|-|-|-
|r \| w \| x| r \| w \| x| r \| w \| x
|4 \| 2 \| 1| 4 \| 2 \| 1| 4 \| 2 \| 1

    拥有者rwx  组r-x 其他 ---
    chmod -R 750 文件名|目录名
